<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>T√ºrkiye Cami Rehberi - Navigasyon</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
:root {
    --ana-yesil: #14532d;
    --altin: #fbbf24;
    --arka-plan: #052c14;
}

html, body { height:100%; margin:0; font-family: 'Segoe UI', system-ui, sans-serif; background: var(--arka-plan); color: #fff; overflow: hidden; }

/* √úst Panel */
header { 
    background: linear-gradient(135deg, var(--ana-yesil), var(--arka-plan)); 
    padding: 15px; 
    text-align: center;
    border-bottom: 2px solid var(--altin);
}
.logo { font-size: 30px; display: block; filter: drop-shadow(0 0 5px var(--altin)); }
header h1 { margin: 5px 0 0; font-size: 20px; color: var(--altin); }

/* Arama ve Kontrol Alanƒ± */
.controls {
    padding: 12px;
    background: rgba(255,255,255,0.05);
    display: flex;
    flex-direction: column;
    gap: 10px;
}
.search-box {
    position: relative;
    display: flex;
    align-items: center;
}
input#searchInput {
    width: 100%;
    padding: 12px 40px 12px 12px;
    border-radius: 25px;
    border: 1px solid var(--altin);
    font-size: 15px;
    outline: none;
}
.search-icon { position: absolute; right: 15px; color: #666; }

/* En Yakƒ±n Cami Butonu */
.near-btn {
    background: var(--altin);
    color: var(--arka-plan);
    border: none;
    padding: 12px;
    border-radius: 25px;
    font-weight: bold;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: 0.3s;
}
.near-btn:active { transform: scale(0.95); }

/* Harita */
#map { height: calc(100vh - 300px); width: 100%; }

/* Alt Bilgi */
footer {
    position: fixed;
    bottom: 0;
    width: 100%;
    background: rgba(0,0,0,0.9);
    padding: 10px;
    font-size: 12px;
    text-align: center;
    color: #aaa;
}
footer a { color: var(--altin); text-decoration: none; }

/* Popup */
.nav-btn {
    display: block;
    background: #2563eb;
    color: white !important;
    padding: 10px;
    margin-top: 8px;
    border-radius: 5px;
    text-decoration: none;
    text-align: center;
    font-weight: bold;
}
</style>
</head>
<body>

<header>
    <span class="logo">üïå</span>
    <h1>T√ºrkiye Cami Rehberi</h1>
</header>

<div class="controls">
    <select id="il" style="padding:10px; border-radius:10px; border:1px solid var(--altin);">
        <option value="">√ñnce ≈ûehir Se√ßin...</option>
    </select>

    <div class="search-box">
        <input type="text" id="searchInput" placeholder="Cami ismine g√∂re ara..." onkeyup="filterMarkers()">
        <span class="search-icon">üîç</span>
    </div>

    <button class="near-btn" onclick="findNearest()">
        üìç Konumuma En Yakƒ±n Camiyi Bul
    </button>
</div>

<div id="map"></div>

<footer>
    ‚ö†Ô∏è Eksik cami mi var? <a href="https://www.openstreetmap.org/edit" target="_blank">Haritayƒ± G√ºncelle</a>
</footer>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
const iller = ["Adana", "Adƒ±yaman", "Afyonkarahisar", "Aƒürƒ±", "Amasya", "Ankara", "Antalya", "Artvin", "Aydƒ±n", "Balƒ±kesir", "Bilecik", "Bing√∂l", "Bitlis", "Bolu", "Burdur", "Bursa", "√áanakkale", "√áankƒ±rƒ±", "√áorum", "Denizli", "Diyarbakƒ±r", "Edirne", "Elazƒ±ƒü", "Erzincan", "Erzurum", "Eski≈üehir", "Gaziantep", "Giresun", "G√ºm√º≈ühane", "Hakkari", "Hatay", "Isparta", "Mersin", "ƒ∞stanbul", "ƒ∞zmir", "Kars", "Kastamonu", "Kayseri", "Kƒ±rklareli", "Kƒ±r≈üehir", "Kocaeli", "Konya", "K√ºtahya", "Malatya", "Manisa", "Kahramanmara≈ü", "Mardin", "Muƒüla", "Mu≈ü", "Nev≈üehir", "Niƒüde", "Ordu", "Rize", "Sakarya", "Samsun", "Siirt", "Sinop", "Sivas", "Tekirdaƒü", "Tokat", "Trabzon", "Tunceli", "≈ûanlƒ±urfa", "U≈üak", "Van", "Yozgat", "Zonguldak", "Aksaray", "Bayburt", "Karaman", "Kƒ±rƒ±kkale", "Batman", "≈ûƒ±rnak", "Bartƒ±n", "Ardahan", "Iƒüdƒ±r", "Yalova", "Karab√ºk", "Kilis", "Osmaniye", "D√ºzce"];

const ilSelect = document.getElementById("il");
iller.sort((a,b) => a.localeCompare('tr')).forEach(il => {
    let opt = document.createElement("option");
    opt.value = il; opt.text = il;
    ilSelect.add(opt);
});

const map = L.map('map').setView([39, 35], 6);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
let markers = [];
let userLocation = null;

// Konum Al
map.locate({setView: false, maxZoom: 16});
map.on('locationfound', e => {
    userLocation = e.latlng;
    L.marker(e.latlng).addTo(map).bindPopup("Buradasƒ±nƒ±z").openPopup();
});

function fetchData() {
    const il = ilSelect.value;
    if(!il) return;
    markers.forEach(m => map.removeLayer(m));
    markers = [];

    const query = `[out:json][timeout:25];area["name"="${il}"]["admin_level"="4"]->.a;(node["amenity"="place_of_worship"]["religion"="muslim"](area.a);way["amenity"="place_of_worship"]["religion"="muslim"](area.a););out center;`;

    fetch("https://overpass-api.de/api/interpreter", { method:"POST", body:query })
    .then(r => r.json())
    .then(data => {
        data.elements.forEach(el => {
            const lat = el.lat || el.center.lat;
            const lon = el.lon || el.center.lon;
            const name = el.tags.name || "ƒ∞simsiz Cami";

            const m = L.circleMarker([lat, lon], {
                radius: 8, color: "#14532d", fillColor: "#fbbf24", fillOpacity: 0.9
            }).bindPopup(`
                <strong>${name}</strong><br>
                <a class="nav-btn" target="_blank" href="https://www.google.com/maps/dir/?api=1&destination=${lat},${lon}">üöó Yol Tarifi</a>
            `);
            m.name = name.toLowerCase();
            m.addTo(map);
            markers.push(m);
        });
        if(markers.length > 0) map.fitBounds(L.featureGroup(markers).getBounds());
    });
}

// Arama Filtreleme
function filterMarkers() {
    const searchVal = document.getElementById("searchInput").value.toLowerCase();
    markers.forEach(m => {
        if(m.name.includes(searchVal)) m.addTo(map);
        else map.removeLayer(m);
    });
}

// En Yakƒ±n Camiyi Bul
function findNearest() {
    if (!userLocation) {
        alert("Konumunuz hen√ºz alƒ±namadƒ±. L√ºtfen tarayƒ±cƒ±dan konum izni verin.");
        return;
    }
    if (markers.length === 0) {
        alert("√ñnce bir ≈üehir se√ßmelisiniz.");
        return;
    }

    let nearest = null;
    let minDist = Infinity;

    markers.forEach(m => {
        const dist = userLocation.distanceTo(m.getLatLng());
        if (dist < minDist) {
            minDist = dist;
            nearest = m;
        }
    });

    if (nearest) {
        map.setView(nearest.getLatLng(), 17);
        nearest.openPopup();
    }
}

ilSelect.onchange = fetchData;
</script>
</body>
</html>
