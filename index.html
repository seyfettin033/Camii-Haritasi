<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>T√ºrkiye Cami Rehberi - Navigasyon</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
:root { --ana-yesil: #14532d; --altin: #fbbf24; --arka-plan: #052c14; }
html, body { height:100%; margin:0; font-family: 'Segoe UI', sans-serif; background: var(--arka-plan); color: #fff; overflow: hidden; }
header { background: linear-gradient(135deg, var(--ana-yesil), var(--arka-plan)); padding: 10px; text-align: center; border-bottom: 2px solid var(--altin); }
.logo { font-size: 24px; display: block; filter: drop-shadow(0 0 5px var(--altin)); }
header h1 { margin: 2px 0 0; font-size: 16px; color: var(--altin); }

/* ARAMA √áUBUƒûU VE KONTROLLER */
.controls { padding: 10px; display: flex; flex-direction: column; gap: 8px; background: rgba(0,0,0,0.3); }
select, input { width: 100%; padding: 10px; border-radius: 20px; border: 1px solid var(--altin); font-size: 14px; box-sizing: border-box; }
.near-btn { background: var(--altin); color: var(--arka-plan); border: none; padding: 10px; border-radius: 20px; font-weight: bold; cursor: pointer; }

#map { height: calc(100vh - 260px); width: 100%; }
.nav-btn { display: block; background: #2563eb; color: white !important; padding: 10px; margin-top: 5px; border-radius: 5px; text-decoration: none; text-align: center; font-weight: bold; }
footer { position: fixed; bottom: 0; width: 100%; background: #000; padding: 5px; font-size: 10px; text-align: center; }
</style>
</head>
<body>
<header><span class="logo">üïå</span><h1>T√ºrkiye Cami Rehberi</h1></header>
<div class="controls">
    <select id="il"><option value="">≈ûehir Se√ßin...</option></select>
    <input type="text" id="searchInput" placeholder="üîç Cami ismine g√∂re ara..." onkeyup="filterMarkers()">
    <button class="near-btn" onclick="findNearest()">üìç En Yakƒ±n Camiyi Bul</button>
</div>
<div id="map"></div>
<footer>Eksik cami mi var? <a href="https://www.openstreetmap.org/edit" target="_blank" style="color:var(--altin)">D√ºzelt</a></footer>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
const iller = ["Adana", "Adƒ±yaman", "Afyonkarahisar", "Aƒürƒ±", "Amasya", "Ankara", "Antalya", "Artvin", "Aydƒ±n", "Balƒ±kesir", "Bilecik", "Bing√∂l", "Bitlis", "Bolu", "Burdur", "Bursa", "√áanakkale", "√áankƒ±rƒ±", "√áorum", "Denizli", "Diyarbakƒ±r", "Edirne", "Elazƒ±ƒü", "Erzincan", "Erzurum", "Eski≈üehir", "Gaziantep", "Giresun", "G√ºm√º≈ühane", "Hakkari", "Hatay", "Isparta", "Mersin", "ƒ∞stanbul", "ƒ∞zmir", "Kars", "Kastamonu", "Kayseri", "Kƒ±rklareli", "Kƒ±r≈üehir", "Kocaeli", "Konya", "K√ºtahya", "Malatya", "Manisa", "Kahramanmara≈ü", "Mardin", "Muƒüla", "Mu≈ü", "Nev≈üehir", "Niƒüde", "Ordu", "Rize", "Sakarya", "Samsun", "Siirt", "Sinop", "Sivas", "Tekirdaƒü", "Tokat", "Trabzon", "Tunceli", "≈ûanlƒ±urfa", "U≈üak", "Van", "Yozgat", "Zonguldak", "Aksaray", "Bayburt", "Karaman", "Kƒ±rƒ±kkale", "Batman", "≈ûƒ±rnak", "Bartƒ±n", "Ardahan", "Iƒüdƒ±r", "Yalova", "Karab√ºk", "Kilis", "Osmaniye", "D√ºzce"];
const ilSelect = document.getElementById("il");
iller.sort((a,b)=>a.localeCompare('tr')).forEach(il=>{let o=document.createElement("option");o.value=il;o.text=il;ilSelect.add(o);});

const map = L.map('map').setView([39, 35], 6);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
let markers = [], userLocation = null;

map.locate({setView: false, maxZoom: 16});
map.on('locationfound', e => { userLocation = e.latlng; L.circle(e.latlng, {radius:100}).addTo(map).bindPopup("Siz Buradasƒ±nƒ±z"); });

function fetchData() {
    const il = ilSelect.value; if(!il) return;
    markers.forEach(m => map.removeLayer(m)); markers = [];
    const query = `[out:json][timeout:25];area["name"="${il}"]["admin_level"="4"]->.a;(node["amenity"="place_of_worship"]["religion"="muslim"](area.a);way["amenity"="place_of_worship"]["religion"="muslim"](area.a););out center;`;
    fetch("https://overpass-api.de/api/interpreter", { method:"POST", body:query }).then(r=>r.json()).then(data=>{
        data.elements.forEach(el=>{
            const lat=el.lat||el.center.lat, lon=el.lon||el.center.lon, name=el.tags.name||"ƒ∞simsiz Cami";
            const m = L.circleMarker([lat, lon], {radius: 8, color: "#14532d", fillColor: "#fbbf24", fillOpacity: 0.9})
            .bindPopup(`<strong>${name}</strong><br><a class="nav-btn" target="_blank" href="https://www.google.com/maps/dir/?api=1&destination=${lat},${lon}">üöó Yol Tarifi</a>`);
            m.name = name.toLowerCase(); markers.push(m); m.addTo(map);
        });
        if(markers.length>0) map.fitBounds(L.featureGroup(markers).getBounds());
    });
}
function filterMarkers() {
    const s = document.getElementById("searchInput").value.toLowerCase();
    markers.forEach(m => { if(m.name.includes(s)) m.addTo(map); else map.removeLayer(m); });
}
function findNearest() {
    if(!userLocation || markers.length===0) return alert("Konum alƒ±namadƒ± veya ≈üehir se√ßilmedi!");
    let nearest = markers.reduce((prev, curr) => userLocation.distanceTo(curr.getLatLng()) < userLocation.distanceTo(prev.getLatLng()) ? curr : prev);
    map.setView(nearest.getLatLng(), 17); nearest.openPopup();
}
ilSelect.onchange = fetchData;
</script>
</body>
</html>
