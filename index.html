<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cami Rehberi - Navigasyon</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <style>
        :root { --yesil: #064e3b; --altin: #fbbf24; }
        body { margin: 0; font-family: sans-serif; background: #022c22; color: white; }
        .pnl { padding: 15px; display: flex; flex-direction: column; gap: 10px; background: var(--yesil); border-bottom: 2px solid var(--altin); }
        select, input, .btn { padding: 12px; border-radius: 10px; border: 1px solid var(--altin); font-size: 15px; width: 100%; box-sizing: border-box; }
        .btn { background: var(--altin); color: black; font-weight: bold; cursor: pointer; border: none; }
        #map { height: calc(100vh - 280px); width: 100%; }
        .nav-link { display: block; background: #2563eb; color: white; padding: 10px; text-align: center; text-decoration: none; border-radius: 5px; margin-top: 10px; font-weight: bold; }
    </style>
</head>
<body>

<div class="pnl">
    <h3 style="margin:0; text-align:center; color:var(--altin);">ğŸ•Œ Cami Rehberi</h3>
    <select id="ilSec">
        <option value="">Ä°l SeÃ§iniz...</option>
    </select>
    <input type="text" id="aramaKutusu" placeholder="ğŸ” Cami ismi ile ara..." onkeyup="filtrele()">
    <button class="btn" onclick="enYakiniBul()">ğŸ“ En YakÄ±n Camiyi Bul</button>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    const iller = ["Adana", "AdÄ±yaman", "Afyonkarahisar", "AÄŸrÄ±", "Amasya", "Ankara", "Antalya", "Artvin", "AydÄ±n", "BalÄ±kesir", "Bilecik", "BingÃ¶l", "Bitlis", "Bolu", "Burdur", "Bursa", "Ã‡anakkale", "Ã‡ankÄ±rÄ±", "Ã‡orum", "Denizli", "DiyarbakÄ±r", "Edirne", "ElazÄ±ÄŸ", "Erzincan", "Erzurum", "EskiÅŸehir", "Gaziantep", "Giresun", "GÃ¼mÃ¼ÅŸhane", "Hakkari", "Hatay", "Isparta", "Mersin", "Ä°stanbul", "Ä°zmir", "Kars", "Kastamonu", "Kayseri", "KÄ±rklareli", "KÄ±rÅŸehir", "Kocaeli", "Konya", "KÃ¼tahya", "Malatya", "Manisa", "KahramanmaraÅŸ", "Mardin", "MuÄŸla", "MuÅŸ", "NevÅŸehir", "NiÄŸde", "Ordu", "Rize", "Sakarya", "Samsun", "Siirt", "Sinop", "Sivas", "TekirdaÄŸ", "Tokat", "Trabzon", "Tunceli", "ÅanlÄ±urfa", "UÅŸak", "Van", "Yozgat", "Zonguldak", "Aksaray", "Bayburt", "Karaman", "KÄ±rÄ±kkale", "Batman", "ÅÄ±rnak", "BartÄ±n", "Ardahan", "IÄŸdÄ±r", "Yalova", "KarabÃ¼k", "Kilis", "Osmaniye", "DÃ¼zce"];
    const ilSec = document.getElementById("ilSec");
    iller.sort((a,b)=>a.localeCompare('tr')).forEach(il => {
        let o = document.createElement("option"); o.value = il; o.text = il; ilSec.add(o);
    });

    const map = L.map('map').setView([39, 35], 6);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
    
    let markers = [];
    let cihazKonum = null;

    // Cihaz konumunu al
    map.locate({setView: false});
    map.on('locationfound', e => {
        cihazKonum = e.latlng;
        L.circle(e.latlng, {radius: 50, color: 'blue'}).addTo(map).bindPopup("BuradasÄ±nÄ±z");
    });

    ilSec.onchange = function() {
        const il = this.value;
        if(!il) return;

        // Eskileri temizle
        markers.forEach(m => map.removeLayer(m));
        markers = [];

        // Veri Ã‡ekme Sorgusu (Garantili YÃ¶ntem)
        const sorgu = `[out:json][timeout:30];area["name"="${il}"]["admin_level"="4"]->.a;(node["amenity"="place_of_worship"]["religion"="muslim"](area.a);way["amenity"="place_of_worship"]["religion"="muslim"](area.a););out center;`;
        
        fetch("https://overpass-api.de/api/interpreter", {method: "POST", body: sorgu})
        .then(res => res.json())
        .then(data => {
            data.elements.forEach(el => {
                const lat = el.lat || el.center.lat;
                const lon = el.lon || el.center.lon;
                const isim = el.tags.name || "Ä°simsiz Cami";

                const m = L.circleMarker([lat, lon], {
                    radius: 8, color: '#064e3b', fillColor: '#fbbf24', fillOpacity: 1
                }).bindPopup(`
                    <b style="color:black">${isim}</b><br>
                    <a class="nav-link" target="_blank" href="https://www.google.com/maps/dir/?api=1&destination=${lat},${lon}">ğŸš— Yol Tarifi Al</a>
                `);
                m.camiAdi = isim.toLowerCase();
                markers.push(m);
                m.addTo(map);
            });
            if(markers.length > 0) map.fitBounds(L.featureGroup(markers).getBounds());
        })
        .catch(err => alert("Veri Ã§ekilirken hata oluÅŸtu, lÃ¼tfen tekrar deneyin."));
    };

    function filtrele() {
        const kelime = document.getElementById("aramaKutusu").value.toLowerCase();
        markers.forEach(m => {
            if(m.camiAdi.includes(kelime)) m.addTo(map);
            else map.removeLayer(m);
        });
    }

    function enYakiniBul() {
        if(!cihazKonum) return alert("Konumunuz henÃ¼z belirlenmedi. LÃ¼tfen izin verin.");
        if(markers.length === 0) return alert("LÃ¼tfen Ã¶nce bir il seÃ§in.");

        let enYakin = markers[0];
        let enKisaMesafe = cihazKonum.distanceTo(markers[0].getLatLng());

        markers.forEach(m => {
            let d = cihazKonum.distanceTo(m.getLatLng());
            if(d < enKisaMesafe) {
                enKisaMesafe = d;
                enYakin = m;
            }
        });

        map.setView(enYakin.getLatLng(), 17);
        enYakin.openPopup();
    }
</script>
</body>
</html>
