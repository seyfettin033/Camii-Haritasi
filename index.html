<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cami Rehberi Pro</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <style>
        :root { --ana-renk: #064e3b; --altin: #fbbf24; --kirmizi: #e30a17; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: #022c22; color: white; }
        
        /* BayraklÄ± Header */
        .header { 
            background: linear-gradient(135deg, var(--ana-renk), #022c22);
            padding: 15px; border-bottom: 3px solid var(--altin);
            text-align: center; display: flex; flex-direction: column; align-items: center; gap: 8px;
        }
        .bayrak-kutusu { display: flex; align-items: center; gap: 12px; }
        .tr-flag { width: 45px; height: auto; border-radius: 4px; box-shadow: 0 0 10px rgba(255,255,255,0.2); }
        
        /* Kontrol Paneli */
        .kontrol-merkezi { padding: 15px; display: flex; flex-direction: column; gap: 10px; background: rgba(0,0,0,0.3); }
        select, input, .btn-bul { 
            padding: 14px; border-radius: 12px; border: 1px solid var(--altin); 
            font-size: 16px; width: 100%; box-sizing: border-box; outline: none;
        }
        input { background: white; color: black; }
        .btn-bul { 
            background: var(--altin); color: black; font-weight: bold; cursor: pointer; border: none;
            text-transform: uppercase; transition: 0.2s;
        }
        .btn-bul:active { transform: scale(0.96); }

        #map { height: calc(100vh - 320px); width: 100%; }
        .yol-tarifi { 
            display: block; background: #2563eb; color: white !important; 
            padding: 12px; text-align: center; text-decoration: none; 
            border-radius: 8px; margin-top: 10px; font-weight: bold;
        }
    </style>
</head>
<body>

<div class="header">
    <div class="bayrak-kutusu">
        <span>ğŸ•Œ</span>
        <img src="https://upload.wikimedia.org/wikipedia/commons/b/b4/Flag_of_Turkey.svg" class="tr-flag" alt="TR">
        <span>ğŸ•Œ</span>
    </div>
    <div style="font-weight: bold; color: var(--altin); font-size: 20px;">TÃœRKÄ°YE CAMÄ° REHBERÄ°</div>
</div>

<div class="kontrol-merkezi">
    <select id="ilSec">
        <option value="">LÃ¼tfen Åehir SeÃ§in...</option>
    </select>
    <input type="text" id="arama" placeholder="ğŸ” Cami ismiyle ara..." onkeyup="filtrele()">
    <button class="btn-bul" onclick="enYakiniBul()">ğŸ“ En YakÄ±n Camiyi GÃ¶ster</button>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    const iller = ["Adana", "AdÄ±yaman", "Afyonkarahisar", "AÄŸrÄ±", "Amasya", "Ankara", "Antalya", "Artvin", "AydÄ±n", "BalÄ±kesir", "Bilecik", "BingÃ¶l", "Bitlis", "Bolu", "Burdur", "Bursa", "Ã‡anakkale", "Ã‡ankÄ±rÄ±", "Ã‡orum", "Denizli", "DiyarbakÄ±r", "Edirne", "ElazÄ±ÄŸ", "Erzincan", "Erzurum", "EskiÅŸehir", "Gaziantep", "Giresun", "GÃ¼mÃ¼ÅŸhane", "Hakkari", "Hatay", "Isparta", "Mersin", "Ä°stanbul", "Ä°zmir", "Kars", "Kastamonu", "Kayseri", "KÄ±rklareli", "KÄ±rÅŸehir", "Kocaeli", "Konya", "KÃ¼tahya", "Malatya", "Manisa", "KahramanmaraÅŸ", "Mardin", "MuÄŸla", "MuÅŸ", "NevÅŸehir", "NiÄŸde", "Ordu", "Rize", "Sakarya", "Samsun", "Siirt", "Sinop", "Sivas", "TekirdaÄŸ", "Tokat", "Trabzon", "Tunceli", "ÅanlÄ±urfa", "UÅŸak", "Van", "Yozgat", "Zonguldak", "Aksaray", "Bayburt", "Karaman", "KÄ±rÄ±kkale", "Batman", "ÅÄ±rnak", "BartÄ±n", "Ardahan", "IÄŸdÄ±r", "Yalova", "KarabÃ¼k", "Kilis", "Osmaniye", "DÃ¼zce"];
    const ilMenusu = document.getElementById("ilSec");
    iller.sort((a,b)=>a.localeCompare('tr')).forEach(il => {
        let opt = document.createElement("option"); opt.value = il; opt.text = il; ilMenusu.add(opt);
    });

    const map = L.map('map').setView([39, 35], 6);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
    
    let markerListesi = [];
    let kullaniciKonum = null;

    map.locate({setView: false});
    map.on('locationfound', e => {
        kullaniciKonum = e.latlng;
        L.marker(e.latlng).addTo(map).bindPopup("<b>BuradasÄ±nÄ±z</b>").openPopup();
    });

    ilMenusu.onchange = function() {
        const secilenIl = this.value;
        if(!secilenIl) return;

        markerListesi.forEach(m => map.removeLayer(m));
        markerListesi = [];

        // HÄ±zlÄ± ve Net Sorgu
        const sorgu = `[out:json][timeout:50];area["name"="${secilenIl}"]["admin_level"="4"]->.a;(node["amenity"="place_of_worship"]["religion"="muslim"](area.a);way["amenity"="place_of_worship"]["religion"="muslim"](area.a););out center;`;
        
        fetch("https://overpass-api.de/api/interpreter", {method: "POST", body: sorgu})
        .then(res => res.json())
        .then(data => {
            data.elements.forEach(el => {
                const lat = el.lat || el.center.lat;
                const lon = el.lon || el.center.lon;
                const isim = el.tags.name || "Ä°simsiz Cami";

                const m = L.circleMarker([lat, lon], {
                    radius: 8, color: '#064e3b', fillColor: '#fbbf24', fillOpacity: 1
                }).bindPopup(`
                    <div style="color:black; text-align:center;">
                        <strong>${isim}</strong><br>
                        <a class="yol-tarifi" target="_blank" href="https://www.google.com/maps/dir/?api=1&destination=${lat},${lon}">ğŸš— YOL TARÄ°FÄ° AL</a>
                    </div>
                `);
                m.aramaIsmi = isim.toLowerCase();
                markerListesi.push(m);
                m.addTo(map);
            });
            if(markerListesi.length > 0) map.fitBounds(L.featureGroup(markerListesi).getBounds());
        })
        .catch(() => alert("BaÄŸlantÄ± sorunu oluÅŸtu, lÃ¼tfen ÅŸehri tekrar seÃ§in."));
    };

    function filtrele() {
        const kelime = document.getElementById("arama").value.toLowerCase();
        markerListesi.forEach(m => {
            if(m.aramaIsmi.includes(kelime)) m.addTo(map);
            else map.removeLayer(m);
        });
    }

    function enYakiniBul() {
        if(!kullaniciKonum) return alert("Konumunuz henÃ¼z belirlenmedi.");
        if(markerListesi.length === 0) return alert("Ã–nce bir ÅŸehir seÃ§in.");

        let yakin = markerListesi[0];
        let mesafe = kullaniciKonum.distanceTo(markerListesi[0].getLatLng());

        markerListesi.forEach(m => {
            let d = kullaniciKonum.distanceTo(m.getLatLng());
            if(d < mesafe) { mesafe = d; yakin = m; }
        });

        map.setView(yakin.getLatLng(), 17);
        yakin.openPopup();
    }
</script>
</body>
</html>
