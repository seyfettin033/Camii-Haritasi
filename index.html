<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TÃ¼rkiye Cami Arama Rehberi</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <style>
        :root { --ana: #064e3b; --altin: #fbbf24; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: #022c22; color: white; }
        .ust-bar { background: var(--ana); padding: 15px; border-bottom: 3px solid var(--altin); text-align: center; }
        .bayrak-alanÄ± { display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 5px; }
        .tr-flag { width: 40px; border-radius: 3px; box-shadow: 0 0 5px rgba(0,0,0,0.5); }
        .panel { padding: 10px; display: flex; flex-direction: column; gap: 8px; background: rgba(255,255,255,0.05); }
        select, input, .btn { padding: 12px; border-radius: 10px; border: 1px solid var(--altin); font-size: 15px; width: 100%; box-sizing: border-box; }
        .btn { background: var(--altin); color: black; font-weight: bold; border: none; cursor: pointer; }
        #map { height: calc(100vh - 310px); width: 100%; }
        .tarif-btn { display: block; background: #2563eb; color: white !important; padding: 10px; text-align: center; text-decoration: none; border-radius: 6px; margin-top: 8px; font-weight: bold; }
    </style>
</head>
<body>

<div class="ust-bar">
    <div class="bayrak-alanÄ±">
        <img src="https://upload.wikimedia.org/wikipedia/commons/b/b4/Flag_of_Turkey.svg" class="tr-flag">
        <span style="font-size: 20px;">ğŸ•Œ</span>
    </div>
    <h1 style="margin:0; font-size: 18px; color: var(--altin);">CAMÄ° ARAMA REHBERÄ°</h1>
</div>

<div class="panel">
    <select id="sehirSec"><option value="">Bir Åehir SeÃ§iniz...</option></select>
    <input type="text" id="araKutusu" placeholder="ğŸ” Cami ismiyle arayÄ±n..." onkeyup="filtrele()">
    <button class="btn" onclick="enYakiniBul()">ğŸ“ EN YAKIN CAMÄ°YÄ° BUL</button>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    const sehirler = ["Adana", "AdÄ±yaman", "Afyonkarahisar", "AÄŸrÄ±", "Amasya", "Ankara", "Antalya", "Artvin", "AydÄ±n", "BalÄ±kesir", "Bilecik", "BingÃ¶l", "Bitlis", "Bolu", "Burdur", "Bursa", "Ã‡anakkale", "Ã‡ankÄ±rÄ±", "Ã‡orum", "Denizli", "DiyarbakÄ±r", "Edirne", "ElazÄ±ÄŸ", "Erzincan", "Erzurum", "EskiÅŸehir", "Gaziantep", "Giresun", "GÃ¼mÃ¼ÅŸhane", "Hakkari", "Hatay", "Isparta", "Mersin", "Ä°stanbul", "Ä°zmir", "Kars", "Kastamonu", "Kayseri", "KÄ±rklareli", "KÄ±rÅŸehir", "Kocaeli", "Konya", "KÃ¼tahya", "Malatya", "Manisa", "KahramanmaraÅŸ", "Mardin", "MuÄŸla", "MuÅŸ", "NevÅŸehir", "NiÄŸde", "Ordu", "Rize", "Sakarya", "Samsun", "Siirt", "Sinop", "Sivas", "TekirdaÄŸ", "Tokat", "Trabzon", "Tunceli", "ÅanlÄ±urfa", "UÅŸak", "Van", "Yozgat", "Zonguldak", "Aksaray", "Bayburt", "Karaman", "KÄ±rÄ±kkale", "Batman", "ÅÄ±rnak", "BartÄ±n", "Ardahan", "IÄŸdÄ±r", "Yalova", "KarabÃ¼k", "Kilis", "Osmaniye", "DÃ¼zce"];
    const secim = document.getElementById("sehirSec");
    sehirler.sort((a,b)=>a.localeCompare('tr')).forEach(s => {
        let o = document.createElement("option"); o.value = s; o.text = s; secim.add(o);
    });

    const harita = L.map('map').setView([39, 35], 6);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(harita);
    
    let tumMarkerlar = [], konum = null;

    harita.locate({setView: false});
    harita.on('locationfound', e => { konum = e.latlng; L.marker(e.latlng).addTo(harita).bindPopup("Siz BuradasÄ±nÄ±z"); });

    secim.onchange = function() {
        if(!this.value) return;
        tumMarkerlar.forEach(m => harita.removeLayer(m));
        tumMarkerlar = [];

        // Ã–NEMLÄ°: Sadece ismi olan ("name") camileri getirir
        const sorgu = `[out:json][timeout:60];area["name"="${this.value}"]["admin_level"="4"]->.a;(node["amenity"="place_of_worship"]["religion"="muslim"]["name"](area.a);way["amenity"="place_of_worship"]["religion"="muslim"]["name"](area.a););out center;`;
        
        fetch("https://overpass-api.de/api/interpreter", {method: "POST", body: sorgu})
        .then(r => r.json())
        .then(data => {
            data.elements.forEach(el => {
                const lat = el.lat || el.center.lat, lon = el.lon || el.center.lon;
                const ad = el.tags.name; // Ä°simsiz olanlar sorgu sayesinde zaten gelmeyecek

                const m = L.circleMarker([lat, lon], {radius: 9, color: '#064e3b', fillColor: '#fbbf24', fillOpacity: 1})
                .bindPopup(`<div style="color:black; text-align:center;"><b>${ad}</b><a class="tarif-btn" target="_blank" href="https://www.google.com/maps/dir/?api=1&destination=${lat},${lon}">ğŸš— YOL TARÄ°FÄ°</a></div>`);
                
                m.camiAdi = ad.toLowerCase();
                tumMarkerlar.push(m);
                m.addTo(harita);
            });
            if(tumMarkerlar.length) harita.fitBounds(L.featureGroup(tumMarkerlar).getBounds());
        });
    };

    function filtrele() {
        const kelime = document.getElementById("araKutusu").value.toLowerCase();
        tumMarkerlar.forEach(m => {
            if(m.camiAdi.includes(kelime)) m.addTo(harita);
            else harita.removeLayer(m);
        });
    }

    function enYakiniBul() {
        if(!konum || !tumMarkerlar.length) return alert("Konum alÄ±namadÄ± veya ÅŸehir seÃ§ilmedi.");
        let enYakin = tumMarkerlar.reduce((prev, curr) => konum.distanceTo(curr.getLatLng()) < konum.distanceTo(prev.getLatLng()) ? curr : prev);
        harita.setView(enYakin.getLatLng(), 17);
        enYakin.openPopup();
    }
</script>
</body>
</html>
